\documentclass{article} 
\input{../../lib.sty} 
\allowdisplaybreaks

\title{\texttt{impl SelectionMeasure for RangeDivergence}} 
\author{Michael Shoemate} 
\begin{document}  
\maketitle 
 
\section{Hoare Triple} 
\subsection*{Precondition} 
\subsubsection*{Compiler-verified}
\begin{itemize}
    \item Associated Constant \texttt{ONE\_SHOT}
        \begin{itemize}
            \item \texttt{ONE\_SHOT} is true if the measure supports one-shot top-$k$ composition.
        \end{itemize}
    \item Associated Type \texttt{RV}
        \begin{itemize}
            \item \texttt{RV} must implement trait \rustdoc{traits/samplers/psrn/trait}{InverseCDF}.
        \end{itemize}
    \item Method \texttt{random\_variable}
        \textit{Types consistent with pseudocode.}
    \item Method a\texttt{privacy\_map}
        \textit{Types consistent with pseudocode.}
\end{itemize}

\subsubsection*{Caller-verified}
\begin{itemize}
    \item Method \texttt{random\_variable}
        \begin{itemize}
            \item \texttt{scale} is positive (\textit{cannot be null due to \texttt{FBig} dtype}).
        \end{itemize}
    \item Method \texttt{privacy\_map}
        \begin{itemize}
            \item \texttt{d\_in} is non-null and non-negative.
            \item \texttt{scale} is non-null and non-negative.
        \end{itemize}
\end{itemize}

\subsection*{Pseudocode} 
\label{sec:python-pseudocode} 
\lstinputlisting[language=Python,firstline=2,escapechar=|]{./pseudocode/SelectionMeasure_RangeDivergence.py} 
 
\subsection*{Postcondition} 
\begin{theorem}
    The implementation is consistent with all associated items in the \rustdoc{measurements/report\_noisy\_top\_k/trait}{SelectionMeasure} trait.
    \begin{enumerate}
        \item Associated Constant \texttt{ONE\_SHOT}
        \item Associated Type \texttt{RV}
        \item Method \texttt{random\_variable} 
        \item Method \texttt{privacy\_map}
    \end{enumerate}
\end{theorem}

\begin{proof}[Proof of valid associated constant: \texttt{ONE\_SHOT}]
    \label{proof:ONE_SHOT}
    Since the proof of \texttt{privacy\_map} only holds if $k$ is less than two,
    \texttt{ONE\_SHOT} is defined to be false.
\end{proof}

\begin{definition}
    \label{def:Exponential}
    A random variable follows the Exponential distribution if it has density
    \begin{equation}
        f(x) = \frac{1}{\beta} e^{-z}
    \end{equation}
    where $z = \frac{x - \mu}{\beta}$,
    $\mu$ is the shift (location) parameter and $\beta$ is the scale parameter.
\end{definition}

\begin{proof}[Proof of valid associated type: \texttt{RV}]
    The associated type \texttt{RV} is defined as \texttt{ExponentialRV},
    which represents a random variable following the Exponential distribution \ref{def:Exponential}.
    The compiler verifies that \texttt{ExponentialRV} implements the \rustdoc{traits/samplers/psrn/trait}{InverseCDF} trait.
\end{proof}

\begin{proof}[Proof of valid method: \texttt{random\_variable}]
    By the precondition on \texttt{scale} being positive, 
    \texttt{random\_variable} returns a valid instance of \rustdoc{traits/samplers/psrn/exponential/struct}{ExponentialRV}.
\end{proof}

\begin{proof}[Proof of valid method: \texttt{privacy\_map}]
    To be merged from: https://github.com/opendp/opendp/pull/1678/files
\end{proof}

\end{document} 

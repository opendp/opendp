\documentclass{article}
\input{../../../../lib.sty}

\usepackage[
        backend=biber,
        style=authoryear-comp,
        sorting=nyt,
    ]{biblatex}

\usepackage{thmtools}
\usepackage{thm-restate}
\newtheorem{thm}{Theorem}
\newtheorem{defn}{Definition} 
\newtheorem{prop}{Proposition}
\newcommand{\mrm}[1]{\mathrm{#1}}


\title{\texttt{trait impl InverseCDF for TulapRV}}
\author{Yu-Ju Ku, Jordan Awan, Aishwarya Ramasethu, Michael Shoemate}
\begin{document}

\maketitle

\contrib

Proves soundness of \rustdoc{traits/samplers/psrn/tulap/struct}{TulapRV}.
% in \asOfCommit{mod.rs}{f5bb719}.
\texttt{edge} accepts parameter \texttt{self}, containing the state of the Tulap sampler and \texttt{R} specifying the rounding mode.
\floatingPoint

\begin{tcolorbox}
    \begin{warning}[Code is not constant-time]
        The implementation of \texttt{edge} uses procedures that are vulnerable to timing attacks. 
    \end{warning}
\end{tcolorbox}


\section{Hoare Triple}

\subsection*{Preconditions}
\begin{itemize}
    \item Variable \texttt{self} is of type \texttt{TulapRV}.
    \item Generic \texttt{R} denotes the rounding mode, one of "up" or "down".
\end{itemize}

\subsection*{Pseudocode}

\lstinputlisting[language=Python,firstline=2]{./pseudocode/InverseCDF.py}

\subsection*{Postcondition}

\begin{theorem}

\texttt{edge} returns an upper or lower bound for the true Tulap sample,
a distribution with CDF defined in \texttt{make\_tulap}.
\end{theorem}

\begin{proof} 

\begin{prop}\label{prop1}   % Prop F.6
    The quantile function $F_f^{-1}:(0,1)\rightarrow \mathbb{R}$ for $F_f$ can be expressed as
    \[F_f^{-1}(u) = \begin{cases}
    F_f^{-1}(1-f(u))-1&u<c\\
    \frac{u-1/2}{1-2c}&c\leq u\leq 1-c\\
    F_f^{-1}(f(1-u))+1&u>1-c,
    \end{cases}\]
    where $c$ is the unique fixed point of $f$. 
    {Furthermore, for any $u\in (0,1)$, the expression $Q_f(u)$ takes a finite number of recursive steps to evaluate. Thus,} 
    if $U\sim U(0,1)$, then $F_f^{-1}(U) \sim F_f$. 
\end{prop}

The cdf of $\mathrm{Tulap}(0,b,q)$ is
\[F_N(x) = \begin{cases}
    0&F_{N_0}(x)<q/2\\
    \frac{F_{N_0}(x)-q/2}{1-q}& q/2\leq F_{N_0}(x)\leq 1-q/2\\
    1&F_{N_0}(x)>1-q/2.
\end{cases}\]
By inspection, the fixed point of $f_{\epsilon,\delta}$ is $c=\frac{1-\delta}{1+e^\epsilon}$. 
It is easy to verify that $F_N(x) = c(1/2-x) + (1-c)(x+1/2)$ for $x\in (-1/2,1/2)$. 

The function then uses the inverse transform of a sample of a uniform RV to sample a Tulap RV centered at zero.
Arbitrarily precise estimates of the lower and upper bound of the uniform sample can be retrieved.
$F_N(x)$ is computed conservatively, 
where the values of $b$ and $q$ are computed according to privacy parameters that are no greater than $\epsilon$, $\delta$.

The computation of $F_f^{-1}$ is handled exactly via fractional arithmetic, 
as it involves no transcendental functions.

The function then returns the outcome, shifted by \texttt{self.shift}, a sample from $\mathrm{Tulap}(shift,b,q)$,
where $b = \exp(-\epsilon)$ and $q = \frac{2\delta b}{1-b+2\delta b}$.


\end{proof}
\end{document}

\documentclass{article}
\input{../../lib.sty}

\title{\texttt{fn new\_continuation\_rule}}
\author{Michael Shoemate}
\date{}

\begin{document}

\maketitle

\contrib
Proves soundness of \texttt{fn new\_continuation\_rule}.

\section{Hoare Triple}
\subsection*{Precondition}
\subsubsection*{Compiler-verified}
\begin{itemize}
    \item Argument \texttt{d\_out} of type \texttt{U}.
\end{itemize}
\subsubsection*{User-verified}
None

\subsection*{Pseudocode}
\lstinputlisting[language=Python,firstline=2,escapechar=`]{./pseudocode/new_continuation_rule.py}

\subsubsection*{Postcondition}
\begin{theorem}
    Returns a function that wraps a queryable.
    The wrapped queryable refuses to release any query
    that would cause the privacy loss to exceed \texttt{d\_out}.
\end{theorem}

\begin{proof}
    Line \ref{wrapper} returns a function that wraps a queryable.
    
    The new queryable, whose transition function is defined on line \ref{transition},
    runs the routine on line \ref{external} for every query that could change the privacy loss.
    This routine queries the original queryable for what the pending privacy loss would be,
    after executing the query.
    If the new privacy loss exceeds \texttt{d\_out} on line \ref{check},
    the query is rejected.

    Otherwise, the query is accepted, and the query is passed through to the original queryable on line \ref{eval}.
\end{proof}

\end{document}
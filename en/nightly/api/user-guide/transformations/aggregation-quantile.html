
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Aggregation: Quantile &#8212; OpenDP</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=4f92a2c4" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=f91d6a3704ddd3a9dc0f" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=f91d6a3704ddd3a9dc0f" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=f91d6a3704ddd3a9dc0f"></script>

    <script src="../../../_static/documentation_options.js?v=db770145"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/user-guide/transformations/aggregation-quantile';</script>
    <link rel="icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Measurements" href="../measurements/index.html" />
    <link rel="prev" title="Aggregation: Mean" href="aggregation-mean.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Oct 11, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/opendp-logo.png" class="logo__image only-light" alt="OpenDP - Home"/>
    <script>document.write(`<img src="../../../_static/opendp-logo.png" class="logo__image only-dark" alt="OpenDP - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../../../getting-started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item current active">
                      <a class="nav-link nav-internal" href="../../index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../../../theory/index.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../../../contributing/index.html">
                        Contributing
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/opendp" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../../../getting-started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item current active">
                      <a class="nav-link nav-internal" href="../../index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../../../theory/index.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../../../contributing/index.html">
                        Contributing
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/opendp" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">API User Guide</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../limitations.html">Limitations</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../programming-framework/index.html">Programming Framework</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../programming-framework/core-structures.html">Core Structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../programming-framework/supporting-elements.html">Supporting Elements</a></li>
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="index.html">Transformations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="preprocess-resize.html">Preprocessing: Resize</a></li>
<li class="toctree-l3"><a class="reference internal" href="aggregation-sum.html">Aggregation: Sum</a></li>
<li class="toctree-l3"><a class="reference internal" href="aggregation-mean.html">Aggregation: Mean</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Aggregation: Quantile</a></li>

</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../measurements/index.html">Measurements</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../measurements/additive-noise-mechanisms.html">Additive Noise Mechanisms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../measurements/thresholded-noise-mechanisms.html">Thresholded Noise Mechanisms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../measurements/canonical-noise-mechanism.html">Canonical Noise Mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../measurements/noisy-max-mechanisms.html">Report Noisy Max Mechanisms</a></li>



<li class="toctree-l3"><a class="reference internal" href="../measurements/randomized-response.html">Randomized Response</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../combinators/index.html">Combinators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../combinators/chaining.html">Chaining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combinators/non-adaptive-composition.html">(Non-Adaptive) Composition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combinators/adaptive-composition.html">Adaptive Composition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combinators/fully-adaptive-composition.html">Fully Adaptive Composition and Odometers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combinators/privacy-filters.html">Privacy Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combinators/compositor-chaining-and-nesting.html">Compositor Chaining and Nesting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combinators/measure-casting.html">Measure Casting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combinators/amplification.html">Amplification</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utilities/index.html">Utilities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../utilities/typing.html">Typing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utilities/parameter-search.html">Parameter Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utilities/serialization.html">Serialization</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../context/index.html">Context</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../polars/index.html">Polars</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../polars/polars-vs-opendp.html">Polars vs. OpenDP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../polars/gaussian-noise.html">Gaussian Noise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../polars/bounds.html">Identifier Truncation and Bounds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../polars/data-types.html">Data Types</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../polars/expressions/index.html">Expressions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../polars/expressions/aggregation.html">Aggregation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../polars/expressions/boolean.html">Boolean</a></li>
<li class="toctree-l4"><a class="reference internal" href="../polars/expressions/columns.html">Columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../polars/expressions/manipulation.html">Manipulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../polars/expressions/operators.html">Operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../polars/expressions/string.html">String</a></li>
<li class="toctree-l4"><a class="reference internal" href="../polars/expressions/temporal.html">Temporal</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../plugins/index.html">Plugins</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../plugins/measurement.html">Measurement example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/transformation.html">Transformation example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/context-api-plugins.html">Context API Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/theil-sen-regression.html">Thiel-Sen Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/selecting-grouping-columns.html">Privately Selecting Grouping Columns</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../python/index.html">Python API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../python/opendp.html">opendp package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../python/opendp.extras.html">opendp.extras package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../python/opendp.extras.examples.html">opendp.extras.examples package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python/opendp.extras.mbi.html">opendp.extras.mbi package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python/opendp.extras.numpy.html">opendp.extras.numpy package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python/opendp.extras.polars.html">opendp.extras.polars package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python/opendp.extras.sklearn.html">opendp.extras.sklearn package</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.accuracy.html">opendp.accuracy module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.combinators.html">opendp.combinators module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.context.html">opendp.context module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.core.html">opendp.core module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.domains.html">opendp.domains module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.measurements.html">opendp.measurements module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.measures.html">opendp.measures module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.metrics.html">opendp.metrics module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.mod.html">opendp.mod module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.prelude.html">opendp.prelude module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.transformations.html">opendp.transformations module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../python/opendp.typing.html">opendp.typing module</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.opendp.org/en/stable/api/r">R API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.rs/opendp">Rust API Reference</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<h6>Branches</h6>
<ul>
    <li><a href="../../../../beta/index.html" style="font-weight: normal">beta</a></li>
    <li><a href="aggregation-quantile.html" style="font-weight: bold">nightly</a></li>
    <li><a href="../../../../stable/index.html" style="font-weight: normal">stable</a></li>
</ul>


<h6 id="releases_header">Releases
    <div id="releases_symbol" style="float:right"></div>
</h6>
<ul id="releases_content">
    <li><a href="../../../../v0.14.1/index.html" style="font-weight: normal">v0.14.1</a></li>
    <li><a href="../../../../v0.14.0/index.html" style="font-weight: normal">v0.14.0</a></li>
    <li><a href="../../../../v0.13.0/index.html" style="font-weight: normal">v0.13.0</a></li>
    <li><a href="../../../../v0.12.1/index.html" style="font-weight: normal">v0.12.1</a></li>
    <li><a href="../../../../v0.12.0/index.html" style="font-weight: normal">v0.12.0</a></li>
    <li><a href="../../../../v0.11.1/index.html" style="font-weight: normal">v0.11.1</a></li>
    <li><a href="../../../../v0.11.0/index.html" style="font-weight: normal">v0.11.0</a></li>
    <li><a href="../../../../v0.10.0/index.html" style="font-weight: normal">v0.10.0</a></li>
    <li><a href="../../../../v0.9.2/index.html" style="font-weight: normal">v0.9.2</a></li>
    <li><a href="../../../../v0.9.1/index.html" style="font-weight: normal">v0.9.1</a></li>
    <li><a href="../../../../v0.9.0/index.html" style="font-weight: normal">v0.9.0</a></li>
    <li><a href="../../../../v0.8.0/index.html" style="font-weight: normal">v0.8.0</a></li>
    <li><a href="../../../../v0.7.0/index.html" style="font-weight: normal">v0.7.0</a></li>
    <li><a href="../../../../v0.6.2/index.html" style="font-weight: normal">v0.6.2</a></li>
    <li><a href="../../../../v0.6.1/index.html" style="font-weight: normal">v0.6.1</a></li>
    <li><a href="../../../../v0.6.0/index.html" style="font-weight: normal">v0.6.0</a></li>
    <li><a href="../../../../v0.5.0/index.html" style="font-weight: normal">v0.5.0</a></li>
    <li><a href="../../../../v0.4.0/index.html" style="font-weight: normal">v0.4.0</a></li>
    <li><a href="../../../../v0.3.0/index.html" style="font-weight: normal">v0.3.0</a></li>
    <li><a href="../../../../v0.2.4/index.html" style="font-weight: normal">v0.2.4</a></li>
    <li><a href="../../../../v0.2.3/index.html" style="font-weight: normal">v0.2.3</a></li>
    <li><a href="../../../../v0.2.2/index.html" style="font-weight: normal">v0.2.2</a></li>
    <li><a href="../../../../v0.2.1/index.html" style="font-weight: normal">v0.2.1</a></li>
    <li><a href="../../../../v0.2.0/index.html" style="font-weight: normal">v0.2.0</a></li>
    <li><a href="../../../../v0.1.0/index.html" style="font-weight: normal">v0.1.0</a></li>
</ul>
<script>
    let expanded = !!JSON.parse(localStorage.getItem('expanded'));

    let releasesHeader = document.getElementById("releases_header");
    let releasesSymbol = document.getElementById("releases_symbol");
    let releasesContent = document.getElementById("releases_content");

    function setReleasesState() {
        localStorage.setItem("expanded", JSON.stringify(expanded))
        releasesContent.style.display = expanded ? "block" : "none";
        releasesSymbol.classList.add(expanded ? 'minus' : 'plus')
        releasesSymbol.classList.remove(expanded ? 'plus' : 'minus')
    }

    setReleasesState()
    releasesHeader.addEventListener("click", function() {
        expanded = !expanded;
        setReleasesState()
    })
</script>
<style>
    .plus {
        position: relative;
        width:20px;
        height:20px;
        background:#676767;
    }

    .plus:before,
    .plus:after {
        content: "";
        position:absolute;
        background:#fff;
    }

    .plus:before {
        left:50%;
        top:4px;
        bottom:4px;
        width:3px;
        transform:translateX(-50%);
    }

    .plus:after {
        top:50%;
        left:4px;
        right:4px;
        height:3px;
        transform:translateY(-50%);
    }



    .minus {
        position: relative;
        width:20px;
        height:20px;
        background:#676767;
    }

    .minus:before,
    .minus:after {
        content: "";
        position:absolute;
        background:#fff;
    }

    .minus:after {
        top:50%;
        left:4px;
        right:4px;
        height:3px;
        transform:translateY(-50%);
    }
</style>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">





<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">API</a></li>
    
    
    <li class="breadcrumb-item"><i class="fa-solid fa-ellipsis"></i></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Transformations</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Aggregation:...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item"><div class="admonition warning" style="position: relative;">
    <!--
     Without the style, the region for the article title overlaps, and the link is unclickable.
    -->
    <details>
        <summary>Questions or feedback?</summary>
        <!--
            All of these lists should be in sync:
            - README.md
            - docs/source/contributing/contact.rst
            - docs/source/_templates/questions-feedback.html
            - .github/ISSUE_TEMPLATE/config.yml
        -->
        <ul>
            <li>Report a bug or request a feature on <a href="https://github.com/opendp/opendp/issues">Github</a>.</li>
            <li>Send general queries to <a href="mailto:info@opendp.org">info@opendp.org</a>, or email <a href="mailto:security@opendp.org">security@opendp.org</a> if it is related to security.</li>
            <li>Join the conversation on <a href="https://join.slack.com/t/opendp/shared_invite/zt-zw7o1k2s-dHg8NQE8WTfAGFnN_cwomA">Slack</a>, or the <a href="https://groups.google.com/a/g.harvard.edu/g/opendp-community">mailing list</a>.</li>
        </ul>
    </details>
</div></div>
      
        <div class="header-article-item">
<div class="admonition warning" style="position: relative;" id="old-version-warning">
  <!--
   To work with this locally, in conf.py uncomment the entry under "html_context".

   Without the style, the region for the article title overlaps, and the link is unclickable.
  -->
  <p class="admonition-title">
  
  This documentation is for a development version of OpenDP.
  
  </p>
  <p>The current release of OpenDP is <a href="/">v0.14.1</a>.</p>
</div>
<script>
  window.addEventListener("load", (event) => {
    document.getElementById('old-version-warning').style.top = `${window.visualViewport.pageTop}px`;
  });
</script>
</div>
      
    </div>
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Aggregation:-Quantile">
<h1>Aggregation: Quantile<a class="headerlink" href="#Aggregation:-Quantile" title="Link to this heading">#</a></h1>
<p>This notebook explains techniques for releasing differentially private quantiles. Unlike counts and sums, the quantile can change by a large amount when one person contributes their data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="kn">from</span> <span class="nn">statistics</span> <span class="kn">import</span> <span class="n">median</span>

<span class="c1"># Given bounds of 0 and 100...</span>
<span class="n">L</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span>

<span class="c1"># ...and elements of x are at the bounds...</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">]</span> <span class="o">*</span> <span class="mi">50</span>

<span class="c1"># ...the median changes from 50 to 100 when one individual is added</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before:&#39;</span><span class="p">,</span> <span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after:&#39;</span><span class="p">,</span> <span class="n">median</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">U</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
before: 50.0
after: 100
</pre></div></div>
</div>
<p>Even when the datasets are always non-empty, the sensitivity of <span class="math notranslate nohighlight">\((U - L) / 2\)</span> is too large for additive noise mechanisms to be suitable for estimating quantiles.</p>
<p>Instead of using this dataset of extremes, we’ll demonstrate differentially private techniques with a more realistic skewed dataset sampled from <span class="math notranslate nohighlight">\(\mathrm{Exponential}(\lambda=20)\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="c1"># privacy settings for all examples:</span>
<span class="n">max_contributions</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mf">20.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span> <span class="c1"># a best guess!</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/api_user-guide_transformations_aggregation-quantile_4_0.png" src="../../../_images/api_user-guide_transformations_aggregation-quantile_4_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="c1"># true quantiles</span>
<span class="n">quartiles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]</span>
<span class="n">true_quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">quartiles</span><span class="p">)</span>
<span class="n">true_quantiles</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[5.800778225846171, 14.663246151408615, 28.49926270360073]
</pre></div></div>
</div>
<hr class="docutils" />
<p>Any functions that have not completed the proof-writing and vetting process may still be accessed if you opt-in to “contrib”. Please contact us if you are interested in proof-writing. Thank you!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="kn">import</span> <span class="nn">opendp.prelude</span> <span class="k">as</span> <span class="nn">dp</span>
<span class="n">dp</span><span class="o">.</span><span class="n">enable_features</span><span class="p">(</span><span class="s2">&quot;contrib&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Quantile-via-Exponential-Mechanism">
<h2>Quantile via Exponential Mechanism<a class="headerlink" href="#Quantile-via-Exponential-Mechanism" title="Link to this heading">#</a></h2>
<p>Individual quantiles can be estimated via <code class="docutils literal notranslate"><span class="pre">private_quantile</span></code>, which uses the exponential mechanism.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="n">context</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">Context</span><span class="o">.</span><span class="n">compositor</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">privacy_unit</span><span class="o">=</span><span class="n">dp</span><span class="o">.</span><span class="n">unit_of</span><span class="p">(</span><span class="n">contributions</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">privacy_loss</span><span class="o">=</span><span class="n">dp</span><span class="o">.</span><span class="n">loss_of</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
    <span class="n">split_evenly_over</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">release_quantile</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">drop_null</span><span class="p">()</span><span class="o">.</span><span class="n">private_quantile</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">max_divergence</span><span class="p">(),</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="p">[</span><span class="n">release_quantile</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">quartiles</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[6.0, 15.0, 28.0]
</pre></div></div>
</div>
<p>This is equivalent to the following, in the lower-level framework API:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="n">input_space</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">vector_domain</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">atom_domain</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="nb">float</span><span class="p">)),</span> <span class="n">dp</span><span class="o">.</span><span class="n">symmetric_distance</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">make_expo_quantiles</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">d_in</span><span class="p">,</span> <span class="n">d_out</span><span class="p">):</span>
    <span class="n">t_pre</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">make_drop_null</span><span class="p">(</span><span class="o">*</span><span class="n">input_space</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_from_scale</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dp</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">make_composition</span><span class="p">([</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">make_private_quantile</span><span class="p">(</span><span class="o">*</span><span class="n">t_pre</span><span class="o">.</span><span class="n">output_space</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">max_divergence</span><span class="p">(),</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span>
        <span class="p">])</span>
    <span class="k">return</span> <span class="n">dp</span><span class="o">.</span><span class="n">binary_search_chain</span><span class="p">(</span><span class="n">make_from_scale</span><span class="p">,</span> <span class="n">d_in</span><span class="o">=</span><span class="n">d_in</span><span class="p">,</span> <span class="n">d_out</span><span class="o">=</span><span class="n">d_out</span><span class="p">)</span>


<span class="n">m_expo_quantile</span> <span class="o">=</span> <span class="n">make_expo_quantiles</span><span class="p">(</span><span class="n">quartiles</span><span class="p">,</span> <span class="n">d_in</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d_out</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">m_expo_quantile</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[6.0, 15.0, 28.0]
</pre></div></div>
</div>
</section>
<section id="Quantile-via-Histogram">
<h2>Quantile via Histogram<a class="headerlink" href="#Quantile-via-Histogram" title="Link to this heading">#</a></h2>
<p>Estimating the cumulative distribution function (CDF) performs better than releasing individual quantiles when you want to release a large number of quantiles. The CDF can be estimated by simply releasing a histogram.</p>
<p>The basic procedure for estimating an <span class="math notranslate nohighlight">\(\alpha\)</span>-quantile is as follows:</p>
<ol class="arabic simple">
<li><p>bin the data, and count the number of elements in each bin privately</p></li>
<li><p>divide the counts by the total to get the probability density of landing in each bin</p></li>
<li><p>sum the densities while scanning from the left until the sum is at least <span class="math notranslate nohighlight">\(\alpha\)</span></p></li>
<li><p>interpolate the bin edges of the terminal bin</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="k">def</span> <span class="nf">make_hist_quantiles</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">d_in</span><span class="p">,</span> <span class="n">d_out</span><span class="p">,</span> <span class="n">num_bins</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bin_names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bins</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">make_from_scale</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">input_space</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_drop_null</span><span class="p">()</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_find_bin</span><span class="p">(</span><span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="c1"># bin the data</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_index</span><span class="p">(</span><span class="n">bin_names</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="c1"># can be omitted. Just set TIA=&quot;usize&quot;, categories=list(range(num_bins)) on next line:</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_count_by_categories</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">bin_names</span><span class="p">,</span> <span class="n">null_category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">then_laplace</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
            <span class="c1"># we&#39;re really only interested in the function on this transformation- the domain and metric don&#39;t matter</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">make_cast_default</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">vector_domain</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">atom_domain</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="nb">int</span><span class="p">)),</span> <span class="n">dp</span><span class="o">.</span><span class="n">symmetric_distance</span><span class="p">(),</span> <span class="n">TOA</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">make_quantiles_from_counts</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">dp</span><span class="o">.</span><span class="n">binary_search_chain</span><span class="p">(</span><span class="n">make_from_scale</span><span class="p">,</span> <span class="n">d_in</span><span class="p">,</span> <span class="n">d_out</span><span class="p">)</span>

<span class="n">hist_quartiles_meas</span> <span class="o">=</span> <span class="n">make_hist_quantiles</span><span class="p">(</span><span class="n">quartiles</span><span class="p">,</span> <span class="n">max_contributions</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
<span class="n">hist_quartiles_meas</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[5.945, 14.73, 28.150000000000006]
</pre></div></div>
</div>
<p>A drawback of using this algorithm is that it can be difficult to choose the number of bins.</p>
<p>If the number of bins is chosen to be very small, then the postprocessor will need to sum fewer instances of noise before reaching the bin of interest, resulting in a better bin selection. However, the bin will be wider, so there will be greater error when interpolating the final answer.</p>
<p>If the number of bins is chosen to be very large, then the same holds in the other direction.</p>
<p>Estimating quantiles via the next algorithm can help make choosing the number of bins less sensitive.</p>
</section>
<section id="Quantile-via-B-ary-Tree">
<h2>Quantile via B-ary Tree<a class="headerlink" href="#Quantile-via-B-ary-Tree" title="Link to this heading">#</a></h2>
<p>A slightly more complicated algorithm that tends to provide better utility is to privatize a B-ary tree instead of a histogram. In this algorithm, the raw counts form the leaf nodes, and a complete tree is constructed by recursively summing groups of size <code class="docutils literal notranslate"><span class="pre">b</span></code>. This results in a structure where each parent node is the sum of its <code class="docutils literal notranslate"><span class="pre">b</span></code> children. Noise is added to each node in the tree, and then a postprocessor makes all nodes of the tree consistent with each other, and returns the leaf nodes.</p>
<p>In the histogram approach, the postprocessor would be influenced by a number of noise sources approximately <span class="math notranslate nohighlight">\(O(n)\)</span> in the number of scanned bins. After this modification, the postprocessor is influenced by a number of noise sources approximately <span class="math notranslate nohighlight">\(O(\log_b(n))\)</span> in the number of scanned bins, and with noise sources of similarly greater magnitude.</p>
<p>This modification introduces a new hyperparameter, the branching factor. <code class="docutils literal notranslate"><span class="pre">choose_branching_factor</span></code> provides a heuristic for the ideal branching factor, based on information (or a best guess) of the dataset size.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">choose_branching_factor</span><span class="p">(</span><span class="n">size_guess</span><span class="o">=</span><span class="mi">1_000</span><span class="p">)</span>
<span class="n">b</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
26
</pre></div></div>
</div>
<p>We now make the following adjustments to the histogram algorithm:</p>
<ul class="simple">
<li><p>insert a stable (Lipschitz) transformation to construct a b-ary tree before the noise mechanism</p></li>
<li><p>replace the cast postprocessor with a consistency postprocessor</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="k">def</span> <span class="nf">make_tree_quantiles</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">d_in</span><span class="p">,</span> <span class="n">d_out</span><span class="p">,</span> <span class="n">num_bins</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bin_names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bins</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">make_from_scale</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">input_space</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_drop_null</span><span class="p">()</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_find_bin</span><span class="p">(</span><span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="c1"># bin the data</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_index</span><span class="p">(</span><span class="n">bin_names</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="c1"># can be omitted. Just set TIA=&quot;usize&quot;, categories=list(range(num_bins)) on next line:</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_count_by_categories</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">bin_names</span><span class="p">,</span> <span class="n">null_category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_b_ary_tree</span><span class="p">(</span><span class="n">leaf_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_names</span><span class="p">),</span> <span class="n">branching_factor</span><span class="o">=</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">then_laplace</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">make_consistent_b_ary_tree</span><span class="p">(</span><span class="n">branching_factor</span><span class="o">=</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span>  <span class="c1"># postprocessing</span>
            <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">make_quantiles_from_counts</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">)</span>   <span class="c1"># postprocessing</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">dp</span><span class="o">.</span><span class="n">binary_search_chain</span><span class="p">(</span><span class="n">make_from_scale</span><span class="p">,</span> <span class="n">d_in</span><span class="p">,</span> <span class="n">d_out</span><span class="p">)</span>

<span class="n">tree_quartiles_meas</span> <span class="o">=</span> <span class="n">make_tree_quantiles</span><span class="p">(</span><span class="n">quartiles</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">max_contributions</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
<span class="n">tree_quartiles_meas</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[5.963603570000425, 15.090319791380644, 28.162433994583424]
</pre></div></div>
</div>
</section>
</section>
<section id="Simulations">
<h1>Simulations<a class="headerlink" href="#Simulations" title="Link to this heading">#</a></h1>
<p>As a baseline, we’ll start by simulating the exponential mechanism.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="k">def</span> <span class="nf">sample_error</span><span class="p">(</span><span class="n">meas</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">true_quantiles</span> <span class="o">-</span> <span class="n">meas</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="n">m_expo_quantiles</span> <span class="o">=</span> <span class="n">make_expo_quantiles</span><span class="p">(</span><span class="n">quartiles</span><span class="p">,</span> <span class="n">max_contributions</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
<span class="n">expo_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">sample_error</span><span class="p">(</span><span class="n">m_expo_quantiles</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<p>More candidates will always reduce the error, but will increase the execution time. The algorithm runs in <span class="math notranslate nohighlight">\(O(n \log_2(c))\)</span>, where <span class="math notranslate nohighlight">\(c\)</span> is the number of candidates. Notice that the exponential mechanism simulations take a while to execute— longer than all simulations for the following mechanisms, even when running the simulations multiple times for different settings of the number of bins:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="k">def</span> <span class="nf">average_error</span><span class="p">(</span><span class="n">num_bins</span><span class="p">,</span> <span class="n">num_trials</span><span class="p">):</span>
    <span class="n">m_hist_quantiles</span> <span class="o">=</span> <span class="n">make_hist_quantiles</span><span class="p">(</span><span class="n">quartiles</span><span class="p">,</span> <span class="n">max_contributions</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">num_bins</span><span class="p">)</span>
    <span class="n">m_tree_quantiles</span> <span class="o">=</span> <span class="n">make_tree_quantiles</span><span class="p">(</span><span class="n">quartiles</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">max_contributions</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">num_bins</span><span class="p">)</span>

    <span class="n">hist_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">sample_error</span><span class="p">(</span><span class="n">m_hist_quantiles</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">)])</span>
    <span class="n">tree_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">sample_error</span><span class="p">(</span><span class="n">m_tree_quantiles</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">)])</span>

    <span class="k">return</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">hist_err</span><span class="p">,</span> <span class="n">tree_err</span><span class="p">,</span> <span class="n">expo_err</span>


<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">[</span><span class="n">average_error</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span> <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">]],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;number of bins&quot;</span><span class="p">,</span> <span class="s2">&quot;histogram error&quot;</span><span class="p">,</span> <span class="s2">&quot;tree error&quot;</span><span class="p">,</span> <span class="s2">&quot;exponential error&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/api_user-guide_transformations_aggregation-quantile_22_0.png" src="../../../_images/api_user-guide_transformations_aggregation-quantile_22_0.png" />
</div>
</div>
<p>Of the three algorithms, when only estimating three quantiles, the exponential mechanism performs the best. However, the error will increase in the number of estimated quantiles more rapidly for the exponential mechanism than in the CDF-based mechanisms.</p>
<p>The utility of the tree-based algorithm is typically better than the histogram algorithm, and makes the algorithm less sensitive to the number of bins. In these simulations, the heuristic for picking the number of bins (25) was not helpful.</p>
<section id="Privately-Estimating-the-Distribution">
<h2>Privately Estimating the Distribution<a class="headerlink" href="#Privately-Estimating-the-Distribution" title="Link to this heading">#</a></h2>
<p>Instead of postprocessing the noisy counts into quantiles, they can be left as counts, which can be used to visualize the distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="k">def</span> <span class="nf">make_distribution_counts</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="n">bin_names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edges</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">input_space</span> <span class="o">&gt;&gt;</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_find_bin</span><span class="p">(</span><span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="c1"># bin the data</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_index</span><span class="p">(</span><span class="n">bin_names</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="c1"># can be omitted. Just set TIA=&quot;usize&quot;, categories=list(range(num_bins)) on next line:</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_count_by_categories</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">bin_names</span><span class="p">,</span> <span class="n">null_category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">then_laplace</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">make_distribution_counts</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">)(</span><span class="n">data</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)),</span> <span class="n">edges</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;support&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;noisy density&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/api_user-guide_transformations_aggregation-quantile_25_0.png" src="../../../_images/api_user-guide_transformations_aggregation-quantile_25_0.png" />
</div>
</div>
<p>While the utility is not as great as the exponential mechanism, the histogram and tree approaches give more information about the distribution of the data.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="aggregation-mean.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Aggregation: Mean</p>
      </div>
    </a>
    <a class="right-next"
       href="../measurements/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Measurements</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Aggregation: Quantile</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Quantile-via-Exponential-Mechanism">Quantile via Exponential Mechanism</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Quantile-via-Histogram">Quantile via Histogram</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Quantile-via-B-ary-Tree">Quantile via B-ary Tree</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Simulations">Simulations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Privately-Estimating-the-Distribution">Privately Estimating the Distribution</a></li>
</ul>
</li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/api/user-guide/transformations/aggregation-quantile.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=f91d6a3704ddd3a9dc0f"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=f91d6a3704ddd3a9dc0f"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3rc1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>

<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>OpenDP Rust Initiation &#8212; OpenDP</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=4f92a2c4" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=f91d6a3704ddd3a9dc0f" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=f91d6a3704ddd3a9dc0f" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=f91d6a3704ddd3a9dc0f"></script>

    <script src="../_static/documentation_options.js?v=db770145"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contributing/rust-initiation';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="OpenDP Proof Initiation" href="proof-initiation.html" />
    <link rel="prev" title="Development Environment" href="development-environment.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Oct 11, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/opendp-logo.png" class="logo__image only-light" alt="OpenDP - Home"/>
    <script>document.write(`<img src="../_static/opendp-logo.png" class="logo__image only-dark" alt="OpenDP - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../getting-started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../theory/index.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Contributing
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/opendp" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../getting-started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../theory/index.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Contributing
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/opendp" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-involved.html">Getting Involved</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="development-environment.html">Development Environment</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">OpenDP Rust Initiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="proof-initiation.html">OpenDP Proof Initiation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="contribution-process.html">Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="cla.html">Contributor License Agreement</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<h6>Branches</h6>
<ul>
    <li><a href="../../beta/contributing/rust-initiation.html" style="font-weight: normal">beta</a></li>
    <li><a href="rust-initiation.html" style="font-weight: bold">nightly</a></li>
    <li><a href="../../stable/contributing/rust-initiation.html" style="font-weight: normal">stable</a></li>
</ul>


<h6 id="releases_header">Releases
    <div id="releases_symbol" style="float:right"></div>
</h6>
<ul id="releases_content">
    <li><a href="../../v0.14.1/contributing/rust-initiation.html" style="font-weight: normal">v0.14.1</a></li>
    <li><a href="../../v0.14.0/contributing/rust-initiation.html" style="font-weight: normal">v0.14.0</a></li>
    <li><a href="../../v0.13.0/contributing/rust-initiation.html" style="font-weight: normal">v0.13.0</a></li>
    <li><a href="../../v0.12.1/contributing/rust-initiation.html" style="font-weight: normal">v0.12.1</a></li>
    <li><a href="../../v0.12.0/contributing/rust-initiation.html" style="font-weight: normal">v0.12.0</a></li>
    <li><a href="../../v0.11.1/contributing/rust-initiation.html" style="font-weight: normal">v0.11.1</a></li>
    <li><a href="../../v0.11.0/contributing/rust-initiation.html" style="font-weight: normal">v0.11.0</a></li>
    <li><a href="../../v0.10.0/index.html" style="font-weight: normal">v0.10.0</a></li>
    <li><a href="../../v0.9.2/index.html" style="font-weight: normal">v0.9.2</a></li>
    <li><a href="../../v0.9.1/index.html" style="font-weight: normal">v0.9.1</a></li>
    <li><a href="../../v0.9.0/index.html" style="font-weight: normal">v0.9.0</a></li>
    <li><a href="../../v0.8.0/index.html" style="font-weight: normal">v0.8.0</a></li>
    <li><a href="../../v0.7.0/index.html" style="font-weight: normal">v0.7.0</a></li>
    <li><a href="../../v0.6.2/index.html" style="font-weight: normal">v0.6.2</a></li>
    <li><a href="../../v0.6.1/index.html" style="font-weight: normal">v0.6.1</a></li>
    <li><a href="../../v0.6.0/index.html" style="font-weight: normal">v0.6.0</a></li>
    <li><a href="../../v0.5.0/index.html" style="font-weight: normal">v0.5.0</a></li>
    <li><a href="../../v0.4.0/index.html" style="font-weight: normal">v0.4.0</a></li>
    <li><a href="../../v0.3.0/index.html" style="font-weight: normal">v0.3.0</a></li>
    <li><a href="../../v0.2.4/index.html" style="font-weight: normal">v0.2.4</a></li>
    <li><a href="../../v0.2.3/index.html" style="font-weight: normal">v0.2.3</a></li>
    <li><a href="../../v0.2.2/index.html" style="font-weight: normal">v0.2.2</a></li>
    <li><a href="../../v0.2.1/index.html" style="font-weight: normal">v0.2.1</a></li>
    <li><a href="../../v0.2.0/index.html" style="font-weight: normal">v0.2.0</a></li>
    <li><a href="../../v0.1.0/index.html" style="font-weight: normal">v0.1.0</a></li>
</ul>
<script>
    let expanded = !!JSON.parse(localStorage.getItem('expanded'));

    let releasesHeader = document.getElementById("releases_header");
    let releasesSymbol = document.getElementById("releases_symbol");
    let releasesContent = document.getElementById("releases_content");

    function setReleasesState() {
        localStorage.setItem("expanded", JSON.stringify(expanded))
        releasesContent.style.display = expanded ? "block" : "none";
        releasesSymbol.classList.add(expanded ? 'minus' : 'plus')
        releasesSymbol.classList.remove(expanded ? 'plus' : 'minus')
    }

    setReleasesState()
    releasesHeader.addEventListener("click", function() {
        expanded = !expanded;
        setReleasesState()
    })
</script>
<style>
    .plus {
        position: relative;
        width:20px;
        height:20px;
        background:#676767;
    }

    .plus:before,
    .plus:after {
        content: "";
        position:absolute;
        background:#fff;
    }

    .plus:before {
        left:50%;
        top:4px;
        bottom:4px;
        width:3px;
        transform:translateX(-50%);
    }

    .plus:after {
        top:50%;
        left:4px;
        right:4px;
        height:3px;
        transform:translateY(-50%);
    }



    .minus {
        position: relative;
        width:20px;
        height:20px;
        background:#676767;
    }

    .minus:before,
    .minus:after {
        content: "";
        position:absolute;
        background:#fff;
    }

    .minus:after {
        top:50%;
        left:4px;
        right:4px;
        height:3px;
        transform:translateY(-50%);
    }
</style>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Contributing</a></li>
    
    
    <li class="breadcrumb-item"><a href="development-environment.html" class="nav-link">Development Environment</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">OpenDP Rust...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item"><div class="admonition warning" style="position: relative;">
    <!--
     Without the style, the region for the article title overlaps, and the link is unclickable.
    -->
    <details>
        <summary>Questions or feedback?</summary>
        <!--
            All of these lists should be in sync:
            - README.md
            - docs/source/contributing/contact.rst
            - docs/source/_templates/questions-feedback.html
            - .github/ISSUE_TEMPLATE/config.yml
        -->
        <ul>
            <li>Report a bug or request a feature on <a href="https://github.com/opendp/opendp/issues">Github</a>.</li>
            <li>Send general queries to <a href="mailto:info@opendp.org">info@opendp.org</a>, or email <a href="mailto:security@opendp.org">security@opendp.org</a> if it is related to security.</li>
            <li>Join the conversation on <a href="https://join.slack.com/t/opendp/shared_invite/zt-zw7o1k2s-dHg8NQE8WTfAGFnN_cwomA">Slack</a>, or the <a href="https://groups.google.com/a/g.harvard.edu/g/opendp-community">mailing list</a>.</li>
        </ul>
    </details>
</div></div>
      
        <div class="header-article-item">
<div class="admonition warning" style="position: relative;" id="old-version-warning">
  <!--
   To work with this locally, in conf.py uncomment the entry under "html_context".

   Without the style, the region for the article title overlaps, and the link is unclickable.
  -->
  <p class="admonition-title">
  
  This documentation is for a development version of OpenDP.
  
  </p>
  <p>The current release of OpenDP is <a href="/">v0.14.1</a>.</p>
</div>
<script>
  window.addEventListener("load", (event) => {
    document.getElementById('old-version-warning').style.top = `${window.visualViewport.pageTop}px`;
  });
</script>
</div>
      
    </div>
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="opendp-rust-initiation">
<h1>OpenDP Rust Initiation<a class="headerlink" href="#opendp-rust-initiation" title="Link to this heading">#</a></h1>
<p>This notebook is an introduction to the Rust internals of the OpenDP
framework. I’m assuming you have already read about the programming
framework in the user guide, and you have some familiarity with the
library interfaces.</p>
<p>If you have not worked with Rust before, <a class="reference external" href="https://doc.rust-lang.org/stable/book/ch01-00-getting-started.html">a great place to get started
is the Rust
book</a>.
This notebook will also reference sections of the Rust book that surface
commonly in the OpenDP library.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="python" for="sd-tab-item-0">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-pycon notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># we&#39;ll use this Python snip to demonstrate concepts later...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">opendp.prelude</span> <span class="k">as</span> <span class="nn">dp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dp</span><span class="o">.</span><span class="n">enable_features</span><span class="p">(</span><span class="s2">&quot;contrib&quot;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">input_domain</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">vector_domain</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">atom_domain</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_metric</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">symmetric_distance</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">default_cast_trans</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">make_cast_default</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">input_domain</span><span class="p">,</span> <span class="n">input_metric</span><span class="p">,</span> <span class="n">TOA</span><span class="o">=</span><span class="nb">int</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="transformation-structure">
<h2>Transformation Structure<a class="headerlink" href="#transformation-structure" title="Link to this heading">#</a></h2>
<p>The following snip is the definition of a Transformation, from
<a class="reference external" href="https://github.com/opendp/opendp/blob/main/rust/src/core/mod.rs">rust/src/core/mod.rs</a>.
Transformations are structs (<a class="reference external" href="https://doc.rust-lang.org/stable/book/ch05-00-structs.html">see chapter
5</a>).</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">Transformation</span><span class="o">&lt;</span><span class="n">DI</span><span class="p">:</span><span class="w"> </span><span class="nc">Domain</span><span class="p">,</span><span class="w"> </span><span class="n">MI</span><span class="p">:</span><span class="w"> </span><span class="nc">Metric</span><span class="p">,</span><span class="w"> </span><span class="n">DO</span><span class="p">:</span><span class="w"> </span><span class="nc">Domain</span><span class="p">,</span><span class="w"> </span><span class="n">MO</span><span class="p">:</span><span class="w"> </span><span class="nc">Metric</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">input_domain</span><span class="p">:</span><span class="w"> </span><span class="nc">DI</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">input_metric</span><span class="p">:</span><span class="w"> </span><span class="nc">MI</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">output_domain</span><span class="p">:</span><span class="w"> </span><span class="nc">DO</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">output_metric</span><span class="p">:</span><span class="w"> </span><span class="nc">MO</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="nc">Function</span><span class="o">&lt;</span><span class="n">DI</span><span class="p">::</span><span class="n">Carrier</span><span class="p">,</span><span class="w"> </span><span class="n">DO</span><span class="p">::</span><span class="n">Carrier</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">stability_map</span><span class="p">:</span><span class="w"> </span><span class="nc">StabilityMap</span><span class="o">&lt;</span><span class="n">MI</span><span class="p">,</span><span class="w"> </span><span class="n">MO</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This struct has four generics (<a class="reference external" href="https://doc.rust-lang.org/stable/book/ch10-00-generics.html">see chapter
10.1</a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="o">-</span> <span class="n">DI</span> <span class="k">for</span> <span class="nb">input</span> <span class="n">domain</span>
<span class="o">-</span> <span class="n">MI</span> <span class="k">for</span> <span class="nb">input</span> <span class="n">metric</span>
<span class="o">-</span> <span class="n">DO</span> <span class="k">for</span> <span class="n">output</span> <span class="n">domain</span>
<span class="o">-</span> <span class="n">MO</span> <span class="k">for</span> <span class="n">output</span> <span class="n">metric</span>
</pre></div>
</div>
<p>A generic is a type that has not yet been explicitly determined. These
generics let us build transformations out of many different types.</p>
<p>Notice that each of these generics are marked as either <code class="docutils literal notranslate"><span class="pre">Domain</span></code> or
<code class="docutils literal notranslate"><span class="pre">Metric</span></code>. These are called “trait bounds” (<a class="reference external" href="https://doc.rust-lang.org/stable/book/ch10-02-traits.html#trait-bound-syntax">see chapter
10.2</a>).</p>
<p><code class="docutils literal notranslate"><span class="pre">Domain</span></code> and <code class="docutils literal notranslate"><span class="pre">Metric</span></code> are both traits. Trait bounds constrain the
set of possible types that a generic may take on. In this case,
<code class="docutils literal notranslate"><span class="pre">DI:</span> <span class="pre">Domain</span></code> indicates that <code class="docutils literal notranslate"><span class="pre">DI</span></code> may be any type that has the
<code class="docutils literal notranslate"><span class="pre">Domain</span></code> trait implemented for it. There is a reasonably small set of
types that satisfy these trait bounds.</p>
<p>We now take a closer look at each of the struct members.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="o">..</span><span class="p">.</span>
<span class="k">pub</span><span class="w"> </span><span class="n">input_domain</span><span class="p">:</span><span class="w"> </span><span class="nc">DI</span><span class="p">,</span>
<span class="k">pub</span><span class="w"> </span><span class="n">input_metric</span><span class="p">:</span><span class="w"> </span><span class="nc">MI</span><span class="p">,</span>
<span class="k">pub</span><span class="w"> </span><span class="n">output_domain</span><span class="p">:</span><span class="w"> </span><span class="nc">DO</span><span class="p">,</span>
<span class="k">pub</span><span class="w"> </span><span class="n">output_metric</span><span class="p">:</span><span class="w"> </span><span class="nc">MO</span><span class="p">,</span>
<span class="o">..</span><span class="p">.</span>
</pre></div>
</div>
<p>The input and output domains strictly define the set of permissible
input and output values. Examples of domains are <code class="docutils literal notranslate"><span class="pre">AtomDomain</span></code>,
<code class="docutils literal notranslate"><span class="pre">VectorDomain</span></code>, <code class="docutils literal notranslate"><span class="pre">MapDomain</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrameDomain</span></code>. When you
attempt to chain any two transformations, the output domain of the first
transformation must match the input domain of the second transformation
(<a class="reference external" href="https://doc.rust-lang.org/std/cmp/trait.PartialEq.html">via the PartialEq
trait</a>). The
resulting chained transformation contains the input domain of the first
transformation, the output domain of the second transformation, as well
as the functional composition of the two functions.</p>
<p>We also have input and output metrics.</p>
<p>Examples of metrics are <code class="docutils literal notranslate"><span class="pre">HammingDistance</span></code>, <code class="docutils literal notranslate"><span class="pre">SymmetricDistance</span></code>,
<code class="docutils literal notranslate"><span class="pre">AbsoluteDistance</span></code> and <code class="docutils literal notranslate"><span class="pre">L1Distance</span></code>. They behave in the same way
that the input and output domains do when chaining.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="o">..</span><span class="p">.</span>
<span class="k">pub</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="nc">Function</span><span class="o">&lt;</span><span class="n">DI</span><span class="p">,</span><span class="w"> </span><span class="n">DO</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">..</span><span class="p">.</span>
</pre></div>
</div>
<p>We wrap the closure in a <code class="docutils literal notranslate"><span class="pre">Function</span></code> struct that is generic over the
input domain and output domain. The definition of this struct <a class="reference external" href="https://github.com/opendp/opendp/blob/main/rust/src/core/mod.rs">is in the
same
file</a>.</p>
<p>When we invoke the following transformation:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-1" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="python" for="sd-tab-item-1">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-pycon notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">default_cast_trans</span><span class="p">([</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="s2">&quot;1.&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;456&quot;</span><span class="p">])</span>
<span class="go">[0, 0, 2, 456]</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple">
<li><p>the Python data structure is translated into a low-level C
representation and then into a Rust representation</p></li>
<li><p>the Rust <code class="docutils literal notranslate"><span class="pre">function</span></code> is evaluated on a Rust <code class="docutils literal notranslate"><span class="pre">Vec&lt;String&gt;</span></code></p></li>
<li><p>the result is shipped back out to familiar Python data structures</p></li>
</ol>
<p>Finally, the stability map.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="o">..</span><span class="p">.</span>
<span class="k">pub</span><span class="w"> </span><span class="n">stability_map</span><span class="p">:</span><span class="w"> </span><span class="nc">StabilityMap</span><span class="o">&lt;</span><span class="n">MI</span><span class="p">,</span><span class="w"> </span><span class="n">MO</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">..</span><span class="p">.</span>
</pre></div>
</div>
<p>It is a function that takes in an input distance, in the respective
metric space, and returns the smallest acceptable output distance in
terms of the output metric. The definition of this struct <a class="reference external" href="https://github.com/opendp/opendp/blob/main/rust/src/core/mod.rs">is also in
the same
file</a>.</p>
<p>Invoking this function triggers a similar process as the function did:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="python" for="sd-tab-item-2">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-pycon notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">default_cast_trans</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">d_in</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
</div>
</div>
<p>When any two compatible transformations are chained, the resulting
transformation contains a functional composition of the maps.</p>
<p>Ultimately, all pieces are used to construct the new transformation:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>input</p></th>
<th class="head"><p>chaining</p></th>
<th class="head"><p>output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>input_domain_1</p></td>
<td><p>output_domain_1 ==
input_domain_2</p></td>
<td><p>output_domain_2</p></td>
</tr>
<tr class="row-odd"><td><p>function_1</p></td>
<td><p>composed with</p></td>
<td><p>function_2</p></td>
</tr>
<tr class="row-even"><td><p>input_metric_1</p></td>
<td><p>output_metric_1 ==
input_metric_2</p></td>
<td><p>output_metric_2</p></td>
</tr>
<tr class="row-odd"><td><p>stability_map_1</p></td>
<td><p>composed with</p></td>
<td><p>stability_map_2</p></td>
</tr>
</tbody>
</table>
<p>As you’ve seen above, when we want to create a transformation, we use
“constructor” functions. These are, by convention, prefixed with
<code class="docutils literal notranslate"><span class="pre">make_</span></code>.</p>
</section>
<section id="example-transformation-constructor">
<h2>Example Transformation Constructor<a class="headerlink" href="#example-transformation-constructor" title="Link to this heading">#</a></h2>
<p>An example implementation of the casting transformation constructor is
provided. I’ll break it down into three parts.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="c1">// 1.</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">make_cast_default</span><span class="o">&lt;</span><span class="n">TIA</span><span class="p">,</span><span class="w"> </span><span class="n">TOA</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">input_domain</span><span class="p">:</span><span class="w"> </span><span class="nc">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">input_metric</span><span class="p">:</span><span class="w"> </span><span class="nc">M</span>
<span class="p">)</span>
<span class="w">    </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Fallible</span><span class="o">&lt;</span>
<span class="w">        </span><span class="n">Transformation</span><span class="o">&lt;</span>
<span class="w">            </span><span class="n">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">            </span><span class="n">M</span><span class="p">,</span>
<span class="w">            </span><span class="n">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TOA</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">            </span><span class="n">M</span><span class="o">&gt;&gt;</span>

<span class="w">    </span><span class="c1">// 2.</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">TIA</span><span class="p">:</span><span class="w"> </span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Clone</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">CheckNull</span><span class="p">,</span>
<span class="w">          </span><span class="n">TOA</span><span class="p">:</span><span class="w"> </span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RoundCast</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">CheckNull</span><span class="p">,</span>
<span class="w">          </span><span class="n">M</span><span class="p">:</span><span class="w"> </span><span class="nc">DatasetMetric</span><span class="p">,</span>
<span class="w">          </span><span class="p">(</span><span class="n">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">):</span><span class="w"> </span><span class="nc">MetricSpace</span><span class="p">,</span>
<span class="w">          </span><span class="p">(</span><span class="n">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TOA</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">):</span><span class="w"> </span><span class="nc">MetricSpace</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// 3.</span>
<span class="w">    </span><span class="n">Transformation</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="n">input_domain</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">        </span><span class="n">input_metric</span><span class="p">,</span>
<span class="w">        </span><span class="n">VectorDomain</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">AtomDomain</span><span class="p">::</span><span class="n">default</span><span class="p">(),</span><span class="w"> </span><span class="n">input_domain</span><span class="p">.</span><span class="n">size</span><span class="p">),</span>
<span class="w">        </span><span class="n">input_metric</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">        </span><span class="n">Function</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">arg</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;|</span>
<span class="w">            </span><span class="n">arg</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="n">TOA</span><span class="p">::</span><span class="n">round_cast</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">clone</span><span class="p">()).</span><span class="n">unwrap_or_default</span><span class="p">()).</span><span class="n">collect</span><span class="p">()),</span>
<span class="w">        </span><span class="n">StabilityMap</span><span class="p">::</span><span class="n">new_from_constant</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first part is the function signature:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">make_cast_default</span><span class="o">&lt;</span><span class="n">TIA</span><span class="p">,</span><span class="w"> </span><span class="n">TOA</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">input_domain</span><span class="p">:</span><span class="w"> </span><span class="nc">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">input_metric</span><span class="p">:</span><span class="w"> </span><span class="nc">M</span>
<span class="p">)</span>
<span class="w">    </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Fallible</span><span class="o">&lt;</span>
<span class="w">        </span><span class="n">Transformation</span><span class="o">&lt;</span>
<span class="w">            </span><span class="n">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">            </span><span class="n">M</span><span class="p">,</span>
<span class="w">            </span><span class="n">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TOA</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">            </span><span class="n">M</span><span class="o">&gt;&gt;</span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span>
</pre></div>
</div>
<p>Most of the signature consists of types. Rust is strictly typed, so the
code needs to be very explicit about what the type of the constructor
function’s inputs and outputs are.</p>
<p>This is a generic function with two type arguments <code class="docutils literal notranslate"><span class="pre">TIA</span></code> and <code class="docutils literal notranslate"><span class="pre">TOA</span></code>,
standing for “atomic input type” and “atomic output type”, and one type
argument <code class="docutils literal notranslate"><span class="pre">M</span></code>, standing for the type of the metric.</p>
<p>The function takes two concrete arguments, the <code class="docutils literal notranslate"><span class="pre">input_domain</span></code> and
<code class="docutils literal notranslate"><span class="pre">input_metric</span></code>. The types of these arguments are shown after the colon
<code class="docutils literal notranslate"><span class="pre">:</span></code>.</p>
<p>The constructor returns a fallible transformation. The last four lines
specify the types of the input/output domains/metrics, that is, what
<code class="docutils literal notranslate"><span class="pre">DI</span></code>, <code class="docutils literal notranslate"><span class="pre">MI</span></code>, <code class="docutils literal notranslate"><span class="pre">DO</span></code> and <code class="docutils literal notranslate"><span class="pre">MO</span></code> (from the definition of a
Transformation) are.</p>
<p>The second part is the where clause:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="o">..</span><span class="p">.</span>
<span class="k">where</span><span class="w"> </span><span class="n">TIA</span><span class="p">:</span><span class="w"> </span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Clone</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">CheckNull</span><span class="p">,</span>
<span class="w">    </span><span class="n">TOA</span><span class="p">:</span><span class="w"> </span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RoundCast</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">CheckNull</span><span class="p">,</span>
<span class="w">    </span><span class="n">M</span><span class="p">:</span><span class="w"> </span><span class="nc">DatasetMetric</span><span class="p">,</span>
<span class="w">    </span><span class="p">(</span><span class="n">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">):</span><span class="w"> </span><span class="nc">MetricSpace</span><span class="p">,</span>
<span class="w">    </span><span class="p">(</span><span class="n">VectorDomain</span><span class="o">&lt;</span><span class="n">AtomDomain</span><span class="o">&lt;</span><span class="n">TOA</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">):</span><span class="w"> </span><span class="nc">MetricSpace</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="o">..</span><span class="p">.</span>
</pre></div>
</div>
<p>A where clause is another, equivalent way of listing trait bounds on
generics. You can interpret this as, “the compiler will enforce that
<code class="docutils literal notranslate"><span class="pre">TIA</span></code> must be some type that has the <code class="docutils literal notranslate"><span class="pre">Clone</span></code> and <code class="docutils literal notranslate"><span class="pre">CheckNull</span></code>
traits. In other words, while I don’t specify what <code class="docutils literal notranslate"><span class="pre">TIA</span></code> must be
up-front, I can bound what type it may be to types that are cloneable
and have some concept of null-checking. <code class="docutils literal notranslate"><span class="pre">TOA</span></code>, in particular, has a
<code class="docutils literal notranslate"><span class="pre">RoundCast</span></code> trait, which can be used to cast from type <code class="docutils literal notranslate"><span class="pre">TIA</span></code> to
<code class="docutils literal notranslate"><span class="pre">TOA</span></code>. For now, please feel free to ignore the <code class="docutils literal notranslate"><span class="pre">'static</span></code> trait
bounds.</p>
<p>We also restrict the set of valid types that <code class="docutils literal notranslate"><span class="pre">M</span></code> may take on to only
those which the <code class="docutils literal notranslate"><span class="pre">DatasetMetric</span></code> trait has been implemented:
<code class="docutils literal notranslate"><span class="pre">SymmetricDistance</span></code>, <code class="docutils literal notranslate"><span class="pre">InsertDeleteDistance</span></code>, <code class="docutils literal notranslate"><span class="pre">ChangeOneDistance</span></code>
and <code class="docutils literal notranslate"><span class="pre">HammingDistance</span></code>. Finally, there is a trait bound specifying that
the input domain and input metric must, together, form a metric space,
and similarly for the output supporting elements.</p>
<p>The final part is the function body, which creates and implicitly
returns a Transformation struct.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="w">    </span><span class="o">..</span><span class="p">.</span>
<span class="w">    </span><span class="n">Transformation</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="n">input_domain</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">        </span><span class="n">input_metric</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">        </span><span class="n">VectorDomain</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">AtomDomain</span><span class="p">::</span><span class="n">default</span><span class="p">(),</span><span class="w"> </span><span class="n">input_domain</span><span class="p">.</span><span class="n">size</span><span class="p">),</span>
<span class="w">        </span><span class="n">input_metric</span><span class="p">,</span>
<span class="w">        </span><span class="n">Function</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">arg</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">TIA</span><span class="o">&gt;|</span>
<span class="w">            </span><span class="n">arg</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="n">TOA</span><span class="p">::</span><span class="n">round_cast</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">clone</span><span class="p">()).</span><span class="n">unwrap_or_default</span><span class="p">()).</span><span class="n">collect</span><span class="p">()),</span>
<span class="w">        </span><span class="n">StabilityMap</span><span class="p">::</span><span class="n">new_from_constant</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each argument corresponds to a struct member. To make the <code class="docutils literal notranslate"><span class="pre">Function</span></code>,
we use a useful shorthand to create an anonymous closure (a function)
(<a class="reference external" href="https://doc.rust-lang.org/stable/book/ch13-01-closures.html">see chapter
13.1</a>).
For example, <code class="docutils literal notranslate"><span class="pre">|a,</span> <span class="pre">b|</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code>. takes two arguments, <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>. The
function body is <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code>.</p>
<p>This closure casts the data by iterating over each record <code class="docutils literal notranslate"><span class="pre">v</span></code>,
casting, and replacing nulls with the default value for the type (<a class="reference external" href="https://doc.rust-lang.org/stable/book/ch13-02-iterators.html">see
chapter
13.2</a>).</p>
<p>We also take advantage of a convenient constructor for building
a stability map representing a <code class="docutils literal notranslate"><span class="pre">c</span></code>-stable relation. Since the cast function is row-by-row, it is
1-stable.</p>
</section>
<section id="measurement-structure">
<h2>Measurement Structure<a class="headerlink" href="#measurement-structure" title="Link to this heading">#</a></h2>
<p>Measurements are very similar to Transformations, with two key
differences.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Measurement</span><span class="o">&lt;</span><span class="n">DI</span><span class="p">:</span><span class="w"> </span><span class="nc">Domain</span><span class="p">,</span><span class="w"> </span><span class="n">MI</span><span class="p">:</span><span class="w"> </span><span class="nc">Metric</span><span class="p">,</span><span class="w"> </span><span class="n">MO</span><span class="p">:</span><span class="w"> </span><span class="nc">Measure</span><span class="p">,</span><span class="w"> </span><span class="n">TO</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">input_domain</span><span class="p">:</span><span class="w"> </span><span class="nc">DI</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">input_metric</span><span class="p">:</span><span class="w"> </span><span class="nc">MI</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">output_measure</span><span class="p">:</span><span class="w"> </span><span class="nc">MO</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="nc">Function</span><span class="o">&lt;</span><span class="n">DI</span><span class="p">::</span><span class="n">Carrier</span><span class="p">,</span><span class="w"> </span><span class="n">TO</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">privacy_map</span><span class="p">:</span><span class="w"> </span><span class="nc">PrivacyMap</span><span class="o">&lt;</span><span class="n">MI</span><span class="p">,</span><span class="w"> </span><span class="n">MO</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>First, the <code class="docutils literal notranslate"><span class="pre">output_metric</span></code> is replaced with an <code class="docutils literal notranslate"><span class="pre">output_measure</span></code>, as
distances in the output space are measured in terms of divergences
between probability distributions.</p>
<p>Second, the name of the map has changed from a stability map to a
privacy map. This is because the relation between distances now carries
meaning with respect to privacy.</p>
</section>
<section id="developer-loop">
<h2>Developer Loop<a class="headerlink" href="#developer-loop" title="Link to this heading">#</a></h2>
<p>When writing code:</p>
<ol class="arabic simple">
<li><p>Make a change to the Rust source.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">check</span> <span class="pre">--all-features</span></code> to do a quick check for compiler
errors. A properly configured development environment will
automatically run this command for you and highlight your code.</p></li>
<li><p>Read the compiler errors and iterate. Rust errors usually provide
helpful explanations.</p></li>
</ol>
<p>When testing code in Rust, a properly configured development environment
will mark up <code class="docutils literal notranslate"><span class="pre">#[test]</span></code> annotations with a button to execute the test.</p>
<p>When testing code in Python, run <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">build</span> <span class="pre">--all-features</span></code> to
update the binary. You’ll need to restart the Python interpreter or
kernel for changes to appear. All folders named <code class="docutils literal notranslate"><span class="pre">out</span></code> are .gitignored,
so they’re a great place to throw scratch work that you don’t want to
commit.</p>
<p>If you are writing a new function, you’ll need to write FFI bindings
(<code class="docutils literal notranslate"><span class="pre">./ffi.rs</span></code>) and decorate the function with the <code class="docutils literal notranslate"><span class="pre">bootstrap</span></code> macro
before you can access the function from Python. Please don’t hesitate to
ask for help!</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>If you are adding a new file, please place your code inside a
<code class="docutils literal notranslate"><span class="pre">mod.rs</span></code> file in a new folder. This is to give room to place the
proof file adjacent to the implementation.</p></li>
<li><p>Please accompany your sources with a testing module at the end of the
file. Test modules are also a great way to play with your constructor
before the FFI bindings are available.</p></li>
<li><p>Please format your code nicely (rustfmt), add documentation, and
comment meaningfully!</p></li>
</ol>
<p>The other constructor functions in the library are great to use as a
reference. It’s likely you have more questions — this short guide could
never possibly be complete. If you’d like to get more involved in OpenDP
development, don’t hesitate to send a message and we’ll help get you
bootstrapped!</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="development-environment.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Development Environment</p>
      </div>
    </a>
    <a class="right-next"
       href="proof-initiation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">OpenDP Proof Initiation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation-structure">Transformation Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-transformation-constructor">Example Transformation Constructor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measurement-structure">Measurement Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#developer-loop">Developer Loop</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/contributing/rust-initiation.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=f91d6a3704ddd3a9dc0f"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=f91d6a3704ddd3a9dc0f"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3rc1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>
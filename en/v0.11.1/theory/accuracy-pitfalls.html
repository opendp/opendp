
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Accuracy: Pitfalls and Edge Cases &#8212; OpenDP</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=f91d6a3704ddd3a9dc0f" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=4f92a2c4" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=f91d6a3704ddd3a9dc0f" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=f91d6a3704ddd3a9dc0f" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=f91d6a3704ddd3a9dc0f"></script>

    <script src="../_static/documentation_options.js?v=57cbeb03"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'theory/accuracy-pitfalls';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Attacks" href="attacks/index.html" />
    <link rel="prev" title="Differential Privacy with OpenDP" href="dp-with-opendp.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Oct 11, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/opendp-logo.png" class="logo__image only-light" alt="OpenDP - Home"/>
    <script>document.write(`<img src="../_static/opendp-logo.png" class="logo__image only-dark" alt="OpenDP - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../getting-started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../contributing/index.html">
                        Contributing
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/opendp" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../getting-started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item pst-header-nav-item ">
                      <a class="nav-link nav-internal" href="../contributing/index.html">
                        Contributing
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/opendp" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="a-framework-to-understand-dp.html">A Framework to Understand DP</a></li>
<li class="toctree-l1"><a class="reference internal" href="dp-with-opendp.html">Differential Privacy with OpenDP</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Accuracy: Pitfalls and Edge Cases</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="attacks/index.html">Attacks</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="attacks/differencing.html">Differencing</a></li>
<li class="toctree-l2"><a class="reference internal" href="attacks/membership.html">Membership</a></li>
<li class="toctree-l2"><a class="reference internal" href="attacks/reconstruction.html">Reconstruction</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources List</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<h6>Branches</h6>
<ul>
    <li><a href="../../beta/index.html" style="font-weight: normal">beta</a></li>
    <li><a href="../../nightly/index.html" style="font-weight: normal">nightly</a></li>
    <li><a href="../../stable/index.html" style="font-weight: normal">stable</a></li>
</ul>


<h6 id="releases_header">Releases
    <div id="releases_symbol" style="float:right"></div>
</h6>
<ul id="releases_content">
    <li><a href="../../v0.14.1/index.html" style="font-weight: normal">v0.14.1</a></li>
    <li><a href="../../v0.14.0/index.html" style="font-weight: normal">v0.14.0</a></li>
    <li><a href="../../v0.13.0/index.html" style="font-weight: normal">v0.13.0</a></li>
    <li><a href="../../v0.12.1/index.html" style="font-weight: normal">v0.12.1</a></li>
    <li><a href="../../v0.12.0/index.html" style="font-weight: normal">v0.12.0</a></li>
    <li><a href="accuracy-pitfalls.html" style="font-weight: bold">v0.11.1</a></li>
    <li><a href="../../v0.11.0/index.html" style="font-weight: normal">v0.11.0</a></li>
    <li><a href="../../v0.10.0/index.html" style="font-weight: normal">v0.10.0</a></li>
    <li><a href="../../v0.9.2/index.html" style="font-weight: normal">v0.9.2</a></li>
    <li><a href="../../v0.9.1/index.html" style="font-weight: normal">v0.9.1</a></li>
    <li><a href="../../v0.9.0/index.html" style="font-weight: normal">v0.9.0</a></li>
    <li><a href="../../v0.8.0/index.html" style="font-weight: normal">v0.8.0</a></li>
    <li><a href="../../v0.7.0/index.html" style="font-weight: normal">v0.7.0</a></li>
    <li><a href="../../v0.6.2/index.html" style="font-weight: normal">v0.6.2</a></li>
    <li><a href="../../v0.6.1/index.html" style="font-weight: normal">v0.6.1</a></li>
    <li><a href="../../v0.6.0/index.html" style="font-weight: normal">v0.6.0</a></li>
    <li><a href="../../v0.5.0/index.html" style="font-weight: normal">v0.5.0</a></li>
    <li><a href="../../v0.4.0/index.html" style="font-weight: normal">v0.4.0</a></li>
    <li><a href="../../v0.3.0/index.html" style="font-weight: normal">v0.3.0</a></li>
    <li><a href="../../v0.2.4/index.html" style="font-weight: normal">v0.2.4</a></li>
    <li><a href="../../v0.2.3/index.html" style="font-weight: normal">v0.2.3</a></li>
    <li><a href="../../v0.2.2/index.html" style="font-weight: normal">v0.2.2</a></li>
    <li><a href="../../v0.2.1/index.html" style="font-weight: normal">v0.2.1</a></li>
    <li><a href="../../v0.2.0/index.html" style="font-weight: normal">v0.2.0</a></li>
    <li><a href="../../v0.1.0/index.html" style="font-weight: normal">v0.1.0</a></li>
</ul>
<script>
    let expanded = !!JSON.parse(localStorage.getItem('expanded'));

    let releasesHeader = document.getElementById("releases_header");
    let releasesSymbol = document.getElementById("releases_symbol");
    let releasesContent = document.getElementById("releases_content");

    function setReleasesState() {
        localStorage.setItem("expanded", JSON.stringify(expanded))
        releasesContent.style.display = expanded ? "block" : "none";
        releasesSymbol.classList.add(expanded ? 'minus' : 'plus')
        releasesSymbol.classList.remove(expanded ? 'plus' : 'minus')
    }

    setReleasesState()
    releasesHeader.addEventListener("click", function() {
        expanded = !expanded;
        setReleasesState()
    })
</script>
<style>
    .plus {
        position: relative;
        width:20px;
        height:20px;
        background:#676767;
    }

    .plus:before,
    .plus:after {
        content: "";
        position:absolute;
        background:#fff;
    }

    .plus:before {
        left:50%;
        top:4px;
        bottom:4px;
        width:3px;
        transform:translateX(-50%);
    }

    .plus:after {
        top:50%;
        left:4px;
        right:4px;
        height:3px;
        transform:translateY(-50%);
    }



    .minus {
        position: relative;
        width:20px;
        height:20px;
        background:#676767;
    }

    .minus:before,
    .minus:after {
        content: "";
        position:absolute;
        background:#fff;
    }

    .minus:after {
        top:50%;
        left:4px;
        right:4px;
        height:3px;
        transform:translateY(-50%);
    }
</style>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Theory</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Accuracy:...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item"><div class="admonition warning" style="position: relative;">
    <!--
     Without the style, the region for the article title overlaps, and the link is unclickable.
    -->
    <details>
        <summary>Questions or feedback?</summary>
        <!--
            All of these lists should be in sync:
            - README.md
            - docs/source/contributing/contact.rst
            - docs/source/_templates/questions-feedback.html
            - .github/ISSUE_TEMPLATE/config.yml
        -->
        <ul>
            <li>Report a bug or request a feature on <a href="https://github.com/opendp/opendp/issues">Github</a>.</li>
            <li>Send general queries to <a href="mailto:info@opendp.org">info@opendp.org</a>, or email <a href="mailto:security@opendp.org">security@opendp.org</a> if it is related to security.</li>
            <li>Join the conversation on <a href="https://join.slack.com/t/opendp/shared_invite/zt-zw7o1k2s-dHg8NQE8WTfAGFnN_cwomA">Slack</a>, or the <a href="https://groups.google.com/a/g.harvard.edu/g/opendp-community">mailing list</a>.</li>
        </ul>
    </details>
</div></div>
      
        <div class="header-article-item">
<div class="admonition warning" style="position: relative;" id="old-version-warning">
  <!--
   To work with this locally, in conf.py uncomment the entry under "html_context".

   Without the style, the region for the article title overlaps, and the link is unclickable.
  -->
  <p class="admonition-title">
  
  This documentation is for an old version of OpenDP.
  
  </p>
  <p>The current release of OpenDP is <a href="/">v0.14.1</a>.</p>
</div>
<script>
  window.addEventListener("load", (event) => {
    document.getElementById('old-version-warning').style.top = `${window.visualViewport.pageTop}px`;
  });
</script>
</div>
      
    </div>
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Accuracy:-Pitfalls-and-Edge-Cases">
<h1>Accuracy: Pitfalls and Edge Cases<a class="headerlink" href="#Accuracy:-Pitfalls-and-Edge-Cases" title="Link to this heading">#</a></h1>
<p>This notebook describes OpenDP’s accuracy calculations, and ways in which an analyst might be tripped up by them.</p>
<section id="Overview">
<h2>Overview<a class="headerlink" href="#Overview" title="Link to this heading">#</a></h2>
<section id="Accuracy-vs.-Confidence-Intervals">
<h3>Accuracy vs. Confidence Intervals<a class="headerlink" href="#Accuracy-vs.-Confidence-Intervals" title="Link to this heading">#</a></h3>
<p>Each privatizing mechanism (e.g. Laplace, Gaussian) in OpenDP has an associated accuracy that is a function of alpha and the noise scale. Imagine you have data <span class="math notranslate nohighlight">\(D\)</span>, and you want, for some function <span class="math notranslate nohighlight">\(\phi\)</span> to return <span class="math notranslate nohighlight">\(\phi(D)\)</span> in a differentially private way – we will call this value <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span>. An <span class="math notranslate nohighlight">\(\alpha\)</span>-level accuracy guarantee <span class="math notranslate nohighlight">\(a\)</span> promises that, over infinite runs of the privatizing mechanism on the data in question,</p>
<div class="math notranslate nohighlight">
\[\phi(D) \in [\phi_{dp}(D) - a, \phi_{dp}(D) + a]\]</div>
<p>with probability at least <span class="math notranslate nohighlight">\(1 - \alpha\)</span>.</p>
<p>This looks very much like the traditional confidence interval, but it is important to note a major difference. In a canonical confidence interval, the uncertainty being represented is due to sampling error – that is, how often will it be the case that <span class="math notranslate nohighlight">\(\phi(P)\)</span> (the value of <span class="math notranslate nohighlight">\(\phi\)</span> on the underlying population) is within some range of the realized <span class="math notranslate nohighlight">\(\phi(D)\)</span>.</p>
<p>In OpenDP (and differentially private data analysis generally), there is an extra layer of uncertainty due to the noise added to <span class="math notranslate nohighlight">\(\phi(D)\)</span> to produce <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span>. OpenDP’s accuracy utilities described below deal only with the uncertainty of <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span> relative to <span class="math notranslate nohighlight">\(\phi(D)\)</span> and not the uncertainty of <span class="math notranslate nohighlight">\(\phi(D)\)</span> relative to <span class="math notranslate nohighlight">\(\phi(P)\)</span>, but there is ongoing work to provide methods that incorporate both.</p>
</section>
<section id="What-is-D?">
<h3>What is <span class="math notranslate nohighlight">\(D\)</span>?<a class="headerlink" href="#What-is-D?" title="Link to this heading">#</a></h3>
<p>OpenDP allows for analysis of data with an unknown number of rows by resizing the data to ensure consistency with an estimated size (see the <a class="reference internal" href="../getting-started/examples/unknown-dataset-size.html"><span class="doc">unknown dataset size notebook</span></a> for more details). Accuracy guarantees are always relative to the preprocessed data <span class="math notranslate nohighlight">\(\tilde{D}\)</span> and operations such as imputation and clipping are not factored into the accuracy.</p>
</section>
<section id="Synopsis">
<h3>Synopsis<a class="headerlink" href="#Synopsis" title="Link to this heading">#</a></h3>
<p>Say an analyst releases <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span> and gets an accuracy guarantee of <span class="math notranslate nohighlight">\(a\)</span> at accuracy-level <span class="math notranslate nohighlight">\(\alpha\)</span> using the accuracy utilities described below. <span class="math notranslate nohighlight">\(D\)</span> is a dataset of unknown size drawn from population <span class="math notranslate nohighlight">\(P\)</span> and will be resized to <span class="math notranslate nohighlight">\(\tilde{D}\)</span>. This suggests that over infinite runs of this procedure,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\phi_{dp}(D) \in [\phi(\tilde{D}) - a, \phi(\tilde{D}) + a]\)</span> with probability <span class="math notranslate nohighlight">\(1 - \alpha\)</span></p></li>
<li><p>It is likely that <span class="math notranslate nohighlight">\(\phi_{dp}(D) \in [\phi(D) - a, \phi(D) + a]\)</span> with probability <span class="math notranslate nohighlight">\(\approx 1 - \alpha\)</span>, though we cannot make any guarantee. For many cases (e.g. resizing the data based on <span class="math notranslate nohighlight">\(n\)</span> obtained from a differentially private count and reasonable bounds on the data elements), this is likely to be approximately true. In the next section, we will explore some examples of cases where this statement holds to varying extents.</p></li>
<li><p>We cannot directly make statements about the relationship uncertainty of <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span> relative to <span class="math notranslate nohighlight">\(\phi(P)\)</span>.</p></li>
</ul>
</section>
</section>
<section id="Accuracy-Guarantees-In-Practice">
<h2>Accuracy Guarantees In Practice<a class="headerlink" href="#Accuracy-Guarantees-In-Practice" title="Link to this heading">#</a></h2>
<p>We now move to some empirical evaluations of how well our accuracy guarantees translate from <span class="math notranslate nohighlight">\(\phi(\tilde{D})\)</span> to <span class="math notranslate nohighlight">\(\phi(D)\)</span>. We first consider the case where we actually know the size of the underlying data and are able to set plausible lower/upper bounds on <code class="docutils literal notranslate"><span class="pre">age</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="o">![</span><span class="w"> </span>-e<span class="w"> </span>data.csv<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>wget<span class="w"> </span>https://raw.githubusercontent.com/opendp/opendp/main/docs/source/data/PUMS_california_demographics_1000/data.csv
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">opendp.prelude</span> <span class="k">as</span> <span class="nn">dp</span>

<span class="n">dp</span><span class="o">.</span><span class="n">enable_features</span><span class="p">(</span><span class="s2">&quot;contrib&quot;</span><span class="p">)</span>

<span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;data.csv&#39;</span>
<span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;educ&quot;</span><span class="p">,</span> <span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="s2">&quot;married&quot;</span><span class="p">,</span> <span class="s2">&quot;pid&quot;</span><span class="p">]</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">age</span>
<span class="n">D_mean_age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>

<span class="c1"># This will provide the data that will be passed to the aggregator</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># establish extra information for this simulation</span>
<span class="n">age_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span>
<span class="n">n_sims</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="n">D_tilde_mean_age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">age_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">age_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">impute_constant</span> <span class="o">=</span> <span class="mf">50.</span>

<span class="k">def</span> <span class="nf">make_mean_aggregator</span><span class="p">(</span><span class="n">data_size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="c1"># Convert data into a dataframe of string columns</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">make_split_dataframe</span><span class="p">(</span><span class="n">separator</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Selects a column of df, Vec&lt;str&gt;</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">make_select_column</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">TOA</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Cast the column as Vec&lt;float&gt;</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_cast</span><span class="p">(</span><span class="n">TOA</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Impute null values</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_impute_constant</span><span class="p">(</span><span class="n">impute_constant</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Clamp age values</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_clamp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="n">age_bounds</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Resize the dataset to length `data_size`.</span>
        <span class="c1">#     If there are fewer than `data_size` rows in the data, fill with a constant.</span>
        <span class="c1">#     If there are more than `data_size` rows in the data, only keep `data_size` rows</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_resize</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">data_size</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">impute_constant</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">then_mean</span><span class="p">()</span>
    <span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="n">data_size</span> <span class="o">=</span> <span class="mi">1_000</span>

<span class="n">mean_aggregator</span> <span class="o">=</span> <span class="n">make_mean_aggregator</span><span class="p">(</span><span class="n">data_size</span><span class="p">)</span>

<span class="n">scale</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">binary_search_param</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">mean_aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">dp</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">then_laplace</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>

<span class="n">measurement</span> <span class="o">=</span> <span class="n">mean_aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">dp</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">then_laplace</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

<span class="n">releases</span> <span class="o">=</span> <span class="p">[</span><span class="n">measurement</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sims</span><span class="p">)]</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">laplacian_scale_to_accuracy</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy interval (with accuracy value </span><span class="si">{0}</span><span class="s1">) contains the true mean on D_tilde with probability </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">D_tilde_mean_age</span> <span class="o">&gt;=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D_tilde_mean_age</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">accuracy</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy interval (with accuracy value </span><span class="si">{0}</span><span class="s1">) contains the true mean on D with probability </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">D_mean_age</span> <span class="o">&gt;=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D_mean_age</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">accuracy</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy interval (with accuracy value 0.2996) contains the true mean on D_tilde with probability 0.93
Accuracy interval (with accuracy value 0.2996) contains the true mean on D with probability 0.93
</pre></div></div>
</div>
<p>This performance is as expected. <span class="math notranslate nohighlight">\(D\)</span> and <span class="math notranslate nohighlight">\(\tilde{D}\)</span> are actually the exact same data (the maximum age in the raw data is 93, so our clamp to <span class="math notranslate nohighlight">\([0, 100]\)</span> does not change any values, and we know the correct <span class="math notranslate nohighlight">\(n\)</span>), so our theoretical guarantees on <span class="math notranslate nohighlight">\(\tilde{D}\)</span> map exactly to guarantees on <span class="math notranslate nohighlight">\(D\)</span>.</p>
<p>We now move to a scenario that is still realistic, but where the performance does not translate quite as well. In this case, we imagine that the analyst believes the data to be of size 1050 and uses the default imputation within resize so that the extra 50 elements are replaced with a constant.</p>
<p>Note that our diagnostic testing of <span class="math notranslate nohighlight">\(\tilde{D}\)</span> in the code above is not trivial in this case. In the first example, we knew that clamp/resize did not change the underlying data, so we could predict exactly the data on which the DP mean would actually be calculated. This will not be true for the following examples, so we will simulate finding the true underlying mean by releasing an extra DP mean with very high epsilon.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre data-tabindex="0"><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre data-tabindex="0"><span></span><span class="c1"># This estimate is larger than the true size of 1000, so we will impute 50 values using the impute constant</span>
<span class="n">data_size</span> <span class="o">=</span> <span class="mi">1_050</span>

<span class="n">mean_aggregator</span> <span class="o">=</span> <span class="n">make_mean_aggregator</span><span class="p">(</span><span class="n">data_size</span><span class="p">)</span>

<span class="c1"># This value contains the true mean of the data after resizing and imputation</span>
<span class="n">D_tilde_mean</span> <span class="o">=</span> <span class="n">mean_aggregator</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">scale</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">binary_search_param</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">mean_aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">dp</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">then_laplace</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>

<span class="n">measurement</span> <span class="o">=</span> <span class="n">mean_aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">dp</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">then_laplace</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

<span class="n">releases</span> <span class="o">=</span> <span class="p">[</span><span class="n">measurement</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sims</span><span class="p">)]</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">laplacian_scale_to_accuracy</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy interval (with accuracy value </span><span class="si">{0}</span><span class="s1">) contains the true mean on D_tilde with probability </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">D_tilde_mean</span> <span class="o">&gt;=</span> <span class="n">dp_mean</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D_tilde_mean</span> <span class="o">&lt;=</span> <span class="n">dp_mean</span> <span class="o">+</span> <span class="n">accuracy</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">dp_mean</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy interval (with accuracy value </span><span class="si">{0}</span><span class="s1">) contains the true mean on D with probability </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">D_mean_age</span> <span class="o">&gt;=</span> <span class="n">dp_mean</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D_mean_age</span> <span class="o">&lt;=</span> <span class="n">dp_mean</span> <span class="o">+</span> <span class="n">accuracy</span><span class="p">)</span> <span class="k">for</span> <span class="n">dp_mean</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy interval (with accuracy value 0.2853) contains the true mean on D_tilde with probability 0.97
Accuracy interval (with accuracy value 0.2853) contains the true mean on D with probability 0.65
</pre></div></div>
</div>
<p>The accuracy guarantee still holds on <span class="math notranslate nohighlight">\(\tilde{D}\)</span> (as it should), but we now see much worse performance relative to the true underlying data <span class="math notranslate nohighlight">\(D\)</span>.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="dp-with-opendp.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Differential Privacy with OpenDP</p>
      </div>
    </a>
    <a class="right-next"
       href="attacks/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Attacks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Overview">Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Accuracy-vs.-Confidence-Intervals">Accuracy vs. Confidence Intervals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#What-is-D?">What is <span class="math notranslate nohighlight">\(D\)</span>?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Synopsis">Synopsis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Accuracy-Guarantees-In-Practice">Accuracy Guarantees In Practice</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/theory/accuracy-pitfalls.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=f91d6a3704ddd3a9dc0f"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=f91d6a3704ddd3a9dc0f"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3rc1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>